# 13. Поведение данных при редактировании дела

При изменении дела (название, описание, блоки) важно зафиксировать, что происходит с уже существующими записями и с отображением в приложении.

## Изменение названия дела

- Название дела хранится в самой сущности «дело», а не в каждой записи.
- **Записи** остаются привязаны к тому же делу; связь не меняется.
- В интерфейсе (список дел, история записей, заголовки) везде показывается **текущее** название дела. То есть после переименования все экраны отображают новое название, в том числе при просмотре старых записей — контекст задаётся актуальным названием дела.

## Изменение описания дела

- Описание хранится в деле. Записи не хранят копию описания.
- При просмотре формы или контекста дела показывается текущее описание. На старые записи это не влияет.

## Удаление блока

- Блок исчезает из формы: при создании новых записей и при редактировании дела он больше не отображается.
- **В существующих записях** данные по удалённому блоку не теряются: они хранятся для истории. Сохраняются:
  - название блока на момент удаления,
  - введённое значение (ответ пользователя),
  - дата удаления блока.
- При просмотре старой записи удалённые блоки показываются в истории (например, в отдельной секции «Удалённые поля» или с пометкой), чтобы пользователь видел полную картину прошлого ответа. См. [02-entity-deed.md](02-entity-deed.md).

## Добавление блока

- Новый блок появляется в форме и участвует во всех **новых** записях.
- В **старых** записях (созданных до добавления блока) для этого блока значения нет: при просмотре такой записи новый блок отображается пустым (прочерк, «Не заполнено» или поле без значения). Это нормально: запись отражает состояние формы на момент заполнения.

## Переименование блока

Пользователь меняет только текст вопроса (заголовок блока), тип и параметры блока не трогает.

- Заголовок блока хранится в деле. Записи хранят ответ по блоку (по идентификатору блока), а не копию заголовка.
- После переименования при просмотре любой записи (и старой, и новой) отображается **текущее** название блока. То есть везде показывается актуальный заголовок — запись не «замораживает» старый текст вопроса. Если в будущем понадобится показывать «как назывался вопрос на момент ответа», это потребует хранить снимок заголовка в записи (отдельное решение).

## Изменение типа блока

Пользователь может переключить существующий блок с одного типа на другой (например, с «Число» на «Текст (строка)» или с «Один из списка» на «Шкала»). Блок и его название сохраняются; меняется только тип ввода и способ отображения ответа.

- **В старых записях:** блок остаётся, название блока остаётся. Сохранённое значение было введено в старом формате — оно считается устаревшим. При просмотре такой записи система показывает значение с пометкой об устаревании и предлагает **«Обновить»**: пользователь может актуализировать ответ под новый тип (ввести/выбрать значение в новом формате) или оставить как есть. Решение за пользователем.

## Изменение списка вариантов (блоки «Один из списка» и «Несколько из списка»)

Пользователь редактирует варианты ответа в списке: добавляет, правит текст или удаляет вариант.

- **Редактирование значения (переименование варианта).**  
  Вариант — это поле в настройках блока. При изменении текста варианта новое название отображается везде: в форме и во всех записях (старых и новых), где был выбран этот вариант. Данные не теряются, связь по идентификатору варианта сохраняется.

- **Добавление значения.**  
  В список добавляется новый вариант. Он доступен при заполнении новых записей. На старые записи не влияет — в них по-прежнему только те варианты, которые были на момент ответа.

- **Удаление значения из списка.**  
  Вариант убирается из настроек блока и больше не предлагается при новом заполнении. В **старых записях**, где пользователь когда-то выбрал этот вариант, система сохраняет значение и при просмотре показывает его с пометкой об устаревании и предлагает обновить: например, отображается «название: значение (устарело) → Обновить». Пользователь может актуализировать запись (сбросить ответ в этом блоке или выбрать другой вариант из текущего списка).

## Изменение параметров блока без смены типа

Пользователь не меняет тип блока, но меняет его настройки. Пример: в блоке «Шкала» уменьшили количество делений (было 10, стало 5) или поменяли подписи концов шкалы.

- В **старых записях** сохранённое значение (например, число на шкале) остаётся как есть. При просмотре система показывает его с пометкой об устаревании и предлагает **«Обновить»**: пользователь может актуализировать ответ под текущие параметры блока (например, выбрать значение на обновлённой шкале) или оставить как есть.
