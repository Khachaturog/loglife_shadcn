# План разработки фронтенда Log Life

План составлен по бизнес-требованиям из `docs/requirements/`. Mobile first, адаптивная вёрстка.

---

## Фаза 0. Инфраструктура и общее

| # | Задача | Ссылка | Примечание |
|---|--------|--------|------------|
| 0.1 | Роутинг | — | React Router: `/`, `/deeds/:id`, `/deeds/new`, `/deeds/:id/edit`, `/deeds/:id/fill`, `/records/:id`, `/profile` |
| 0.2 | Общий layout | 00, 07 | Плавающая нижняя панель (4 раздела). AppBar — верхняя панель с кнопкой «Назад» для внутренних страниц и форм (редактирование дела, добавление записи, просмотр записи, виджет кликер) |
| 0.3 | Стили и темы | 00 | Radix Themes: TextField, TextArea, Select, Checkbox, RadioGroup, Button и др. DatePicker — [air-datepicker](https://github.com/t1m0n/air-datepicker). Время — нативный `input type="time"` (TextField.Root). CSS-переменные, mobile first, читаемость на десктопе |
| 0.4 | Обработка ошибок API | — | Единый подход: сообщения пользователю при сбоях запросов |

---

## Фаза 1. Список дел (главный экран)

**Документ:** [07-screen-list-deeds.md](requirements/07-screen-list-deeds.md)

| # | Задача | Детали |
|---|--------|--------|
| 1.1 | Экран списка дел | Маршрут `/`. Загрузка дел через `api.deeds.list()` |
| 1.2 | Карточки дел | Эмодзи, название, при необходимости описание/превью. Карточный вид, клик — переход в дело |
| 1.3 | Действие «Переход в дело» | Клик по карточке → страница просмотра дела ([14](requirements/14-screen-deed-view.md)) |
| 1.4 | Действие «Добавить запись» | На карточке кнопка/действие «Добавить запись» → экран заполнения формы ([09](requirements/09-screen-fill-form.md)) |
| 1.5 | Кнопка «+ Создать дело» | Переход на создание дела ([08](requirements/08-screen-create-edit-deed.md), новая форма) |
| 1.6 | Ссылка «Профиль» | Переход на экран профиля ([12](requirements/12-screen-profile.md)) |
| 1.7 | Состояния | Загрузка, ошибка, пустой список («Нет дел. Создайте первое.») |

---

## Фаза 2. Просмотр дела

**Документ:** [14-screen-deed-view.md](requirements/14-screen-deed-view.md)

| # | Задача | Детали |
|---|--------|--------|
| 2.1 | Страница дела | Маршрут `/deeds/:id`. Загрузка `api.deeds.get(id)` (дело с блоками) |
| 2.2 | Отображение дела | Эмодзи, название, описание (если есть) |
| 2.3 | Блок «История записей» | Список записей по делу: дата, время, превью ответов. Логика — [10-screen-history.md](requirements/10-screen-history.md) |
| 2.4 | Кнопка «Добавить запись» | Переход на экран заполнения формы для этого дела |
| 2.5 | Кнопка «Редактировать дело» | Переход на экран редактирования дела |
| 2.6 | Кнопка «Удалить дело» | Подтверждение (модалка/диалог), затем `api.deeds.delete(id)`, редирект в список дел |
| 2.7 | Навигация «Назад» | Возврат к списку дел |

---

## Фаза 3. Создание и редактирование дела

**Документ:** [08-screen-create-edit-deed.md](requirements/08-screen-create-edit-deed.md), сущности [02](requirements/02-entity-deed.md), [03](requirements/03-entity-blocks.md)

| # | Задача | Детали |
|---|--------|--------|
| 3.1 | Маршруты | `/deeds/new` — создание, `/deeds/:id/edit` — редактирование |
| 3.2 | Поля дела | Эмодзи (emoji-mart picker в Popover), название, описание (многострочное, необязательное) |
| 3.3 | Список блоков | Отображение блоков в порядке `sort_order`. Для каждого: заголовок, тип, настройки типа, «Обязательное», порядок, удаление |
| 3.4 | Типы блоков в UI | Число, Текст (строка), Текст (абзац), Один из списка, Несколько из списка, Шкала, Да/Нет — [03](requirements/03-entity-blocks.md) |
| 3.5 | Настройки по типам | Списки: варианты + порядок. Шкала: число делений (макс. 10), подписи первого и последнего значения |
| 3.6 | Обязательность | Чекбокс «Обязательное значение» у каждого блока |
| 3.7 | Порядок блоков | Кнопки вверх/вниз или drag-and-drop ([05](requirements/05-rules-ordering.md)) |
| 3.8 | Удаление блока | Кнопка удаления блока (при сохранении — мягкое удаление на бэкенде) |
| 3.9 | «+ Добавить блок» | Добавление блока, выбор типа (по умолчанию при создании — один блок «Число») |
| 3.10 | Сохранение | Кнопка «Сохранить» / «Создать» → `api.deeds.create()` или `api.deeds.update()`, редирект в список или на страницу дела |
| 3.11 | Режим создания | Пустые поля, один блок типа «Число» по умолчанию |
| 3.12 | Режим редактирования | Подгрузка дела с блоками, отображение в сохранённом порядке |

---

## Фаза 4. Заполнение формы (новая запись)

**Документ:** [09-screen-fill-form.md](requirements/09-screen-fill-form.md), [11-technical-defaults.md](requirements/11-technical-defaults.md)

| # | Задача | Детали |
|---|--------|--------|
| 4.1 | Маршрут | `/deeds/:id/fill`. Загрузка дела с блоками `api.deeds.get(id)` |
| 4.2 | Заголовок | Эмодзи, название дела, при необходимости описание |
| 4.3 | Дата и время записи | Редактируемые поля (по умолчанию — текущие дата и время) |
| 4.4 | Рендер блоков по типу | Число, текст (строка/абзац), один/несколько из списка, шкала, да/нет — согласно [03](requirements/03-entity-blocks.md) |
| 4.5 | Обязательные блоки | Пометка (звёздочка / «Обязательное»), валидация при отправке ([06](requirements/06-rules-required.md)) |
| 4.6 | Кнопка «Добавить запись» | Валидация обязательных → `api.deeds.createRecord(deedId, { record_date, record_time, answers })` |
| 4.7 | После сохранения | Редирект на страницу дела или список дел, при необходимости — сообщение об успехе |

---

## Фаза 5. История записей и просмотр/редактирование записи

**Документ:** [10-screen-history.md](requirements/10-screen-history.md), [14-screen-deed-view.md](requirements/14-screen-deed-view.md)

| # | Задача | Детали |
|---|--------|--------|
| 5.1 | Список записей на странице дела | Уже в фазе 2: дата, время, превью ответов. Загрузка `api.deeds.records(deedId)` |
| 5.2 | Превью ответа | Краткое отображение значения по типу (число, текст, выбранный вариант, шкала, да/нет) |
| 5.3 | Страница одной записи | Маршрут `/records/:id`. Загрузка `api.records.get(id)` — полные ответы + служебные поля |
| 5.4 | Просмотр записи | Все ответы по блокам, дата, время. Устаревшие ответы (блок удалён) — показывать со снимком ([13](requirements/13-rules-editing-deed-data.md)) |
| 5.5 | Редактирование записи | Редактирование даты, времени, ответов. `api.records.update(id, body)` |
| 5.6 | Навигация | «Назад» — к странице дела или списку дел |

---

## Фаза 6. Профиль

**Документ:** [12-screen-profile.md](requirements/12-screen-profile.md)

| # | Задача | Детали |
|---|--------|--------|
| 6.1 | Маршрут | `/profile` |
| 6.2 | Заглушка «Авторизация» | Надпись «Скоро» |
| 6.3 | Заглушка «Экспорт в CSV» | Надпись «Скоро» |
| 6.4 | Навигация | Ссылка с главного экрана/шапки, возврат к списку дел |

---

## Фаза 7. Полировка и правила данных

| # | Задача | Ссылка | Детали |
|---|--------|--------|--------|
| 7.1 | Поведение при редактировании дела | [13](requirements/13-rules-editing-deed-data.md) | Отображение удалённых блоков в старых записях (снимок), изменение названия/типа блока |
| 7.2 | Порядок блоков и вариантов | [05](requirements/05-rules-ordering.md) | Соблюдение `sort_order` при отображении и сохранении |
| 7.3 | Обязательные поля | [06](requirements/06-rules-required.md) | Валидация на форме заполнения и в редакторе записи |
| 7.4 | Адаптивность и доступность | 00 | Mobile first, читаемость, семантика, aria при необходимости |

---

## Порядок выполнения (рекомендуемый)

1. **Фаза 0** — роутер, layout, базовые стили.
2. **Фаза 1** — список дел (карточки, кнопки «Создать дело» и «Профиль»; переход в дело и «Добавить запись» ведут на заглушки, если экраны ещё не готовы).
3. **Фаза 2** — просмотр дела (история записей в виде списка с превью).
4. **Фаза 4** — заполнение формы (чтобы можно было добавлять записи).
5. **Фаза 5** — просмотр и редактирование одной записи.
6. **Фаза 3** — создание/редактирование дела (сложный экран с блоками и типами).
7. **Фаза 6** — профиль (заглушки).
8. **Фаза 7** — правила данных и полировка.

---

## Зависимости

- **Supabase**: БД (Postgres), Auth, клиент с фронта. Схема и RLS — [01-supabase-schema.md](technical/01-supabase-schema.md), миграции в `supabase/migrations/`. Фронт использует `src/lib/supabase.ts` и `src/lib/api.ts`, типы в `src/types/database.ts`.
- После реализации каждой фазы имеет смысл проверять сценарии из соответствующего документа требований.
